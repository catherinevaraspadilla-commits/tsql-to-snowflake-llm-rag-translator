{"chunk_id": "7c6905cc602efe4323074f8ba0aaa4d9dd65ec9b", "doc_id": "commands/AGGREGATE.md", "page_title": "Aggregate Functions", "heading_path": "", "chunk_index": 0, "text": "# Aggregate functions\n\nAggregate functions operate on values across rows to perform calculations such as sum, average, counts, min/max, standard deviation, percentiles/medians, and estimation.  \nAn aggregate function consumes zero, one, or more input rows and produces a **single** output value.  \n(In contrast, **scalar** functions produce one output per input row.)", "approx_tokens": 91}
{"chunk_id": "84f52895e4d9589cdbec0977947b7f9c6e183bfe", "doc_id": "commands/AGGREGATE.md", "page_title": "Aggregate Functions", "heading_path": "Usage", "chunk_index": 0, "text": "## Usage\n\n- Typically used with `GROUP BY`, or over the entire result set if no grouping is specified.  \n- `DISTINCT` is supported by many aggregates (e.g., `COUNT(DISTINCT col)`), with different performance trade-offs.  \n- Some families below include helper functions that are **not** aggregates (noted explicitly).", "approx_tokens": 79}
{"chunk_id": "58a2ea8d0d5068cbe3a9f54622d35c5a42ee29c4", "doc_id": "commands/AGGREGATE.md", "page_title": "Aggregate Functions", "heading_path": "General Aggregation", "chunk_index": 0, "text": "## General Aggregation\n\n- `ANY_VALUE`\n- `AVG`\n- `CORR`\n- `COUNT`, `COUNT_IF`\n- `COVAR_POP`, `COVAR_SAMP`\n- `LISTAGG`\n- `MAX`, `MAX_BY`\n- `MEDIAN`\n- `MIN`, `MIN_BY`\n- `MODE`\n- `PERCENTILE_CONT`  (different syntax than most aggregates)\n- `PERCENTILE_DISC`  (different syntax than most aggregates)\n- `STDDEV`, `STDDEV_SAMP`  (aliases)\n- `STDDEV_POP`\n- `SUM`\n- `VAR_POP`\n- `VAR_SAMP`\n- `VARIANCE_POP`  (alias for `VAR_POP`)\n- `VARIANCE`, `VARIANCE_SAMP`  (aliases for `VAR_SAMP`)", "approx_tokens": 118}
{"chunk_id": "06a801e04a692fac8ee7a5b7d3a7678dc6cbf306", "doc_id": "commands/AGGREGATE.md", "page_title": "Aggregate Functions", "heading_path": "Bitwise Aggregation", "chunk_index": 0, "text": "## Bitwise Aggregation\n\n- `BITAND_AGG`\n- `BITOR_AGG`\n- `BITXOR_AGG`", "approx_tokens": 16}
{"chunk_id": "574fa22430cf02ae6b4f95ab4cc30542d6a42947", "doc_id": "commands/AGGREGATE.md", "page_title": "Aggregate Functions", "heading_path": "Boolean Aggregation", "chunk_index": 0, "text": "## Boolean Aggregation\n\n- `BOOLAND_AGG`\n- `BOOLOR_AGG`\n- `BOOLXOR_AGG`", "approx_tokens": 17}
{"chunk_id": "3d0a6b9bce7b26e06be9431a4b301c948a28412d", "doc_id": "commands/AGGREGATE.md", "page_title": "Aggregate Functions", "heading_path": "Hash", "chunk_index": 0, "text": "## Hash\n\n- `HASH_AGG`", "approx_tokens": 5}
{"chunk_id": "117a5bdc9a27656e2d8ceddb3af3875bac9ddd0e", "doc_id": "commands/AGGREGATE.md", "page_title": "Aggregate Functions", "heading_path": "Semi-structured Data Aggregation", "chunk_index": 0, "text": "## Semi-structured Data Aggregation\n\n- `ARRAY_AGG`\n- `OBJECT_AGG`", "approx_tokens": 16}
{"chunk_id": "dc5007eebf17a08f12844746def384624acbc2e3", "doc_id": "commands/AGGREGATE.md", "page_title": "Aggregate Functions", "heading_path": "Linear Regression (regr_*)", "chunk_index": 0, "text": "## Linear Regression (regr_*)\n\n- `REGR_AVGX`, `REGR_AVGY`, `REGR_COUNT`, `REGR_INTERCEPT`, `REGR_R2`, `REGR_SLOPE`, `REGR_SXX`, `REGR_SXY`, `REGR_SYY`", "approx_tokens": 37}
{"chunk_id": "b1842667554006383724624c2c4b10c037a5fb6e", "doc_id": "commands/AGGREGATE.md", "page_title": "Aggregate Functions", "heading_path": "Statistics and Probability", "chunk_index": 0, "text": "## Statistics and Probability\n\n- `KURTOSIS`, `SKEW`", "approx_tokens": 12}
{"chunk_id": "0561eafeb89f2d0c98e5c93fdff5feb2d705ba70", "doc_id": "commands/AGGREGATE.md", "page_title": "Aggregate Functions", "heading_path": "Counting Distinct Values", "chunk_index": 0, "text": "## Counting Distinct Values\n\n- `ARRAY_UNION_AGG`, `ARRAY_UNIQUE_AGG`\n- `BITMAP_BIT_POSITION`, `BITMAP_BUCKET_NUMBER`, `BITMAP_COUNT`, `BITMAP_CONSTRUCT_AGG`, `BITMAP_OR_AGG`", "approx_tokens": 43}
{"chunk_id": "2bc6056d5078722ced72932e88a4aff73c1c544c", "doc_id": "commands/AGGREGATE.md", "page_title": "Aggregate Functions", "heading_path": "Cardinality Estimation (HyperLogLog family)", "chunk_index": 0, "text": "## Cardinality Estimation (HyperLogLog family)\n\n- `APPROX_COUNT_DISTINCT`  (alias: `HLL`)\n- `DATASKETCHES_HLL`, `DATASKETCHES_HLL_ACCUMULATE`, `DATASKETCHES_HLL_COMBINE`\n- `DATASKETCHES_HLL_ESTIMATE`  — not an aggregate; consumes scalar sketches from ACCUMULATE/COMBINE.\n- `HLL`, `HLL_ACCUMULATE`, `HLL_COMBINE`\n- `HLL_ESTIMATE`  — not an aggregate; consumes scalar sketches from ACCUMULATE/COMBINE.\n- `HLL_EXPORT`, `HLL_IMPORT`", "approx_tokens": 107}
{"chunk_id": "45116bbe87bc25677c0579199da82b8bf91e2d54", "doc_id": "commands/AGGREGATE.md", "page_title": "Aggregate Functions", "heading_path": "Similarity Estimation (MinHash family)", "chunk_index": 0, "text": "## Similarity Estimation (MinHash family)\n\n- `APPROXIMATE_JACCARD_INDEX`  (alias: `APPROXIMATE_SIMILARITY`)\n- `APPROXIMATE_SIMILARITY`\n- `MINHASH`, `MINHASH_COMBINE`", "approx_tokens": 41}
{"chunk_id": "4e98c57fa8db4df839c7bda9f60465083118c0f1", "doc_id": "commands/AGGREGATE.md", "page_title": "Aggregate Functions", "heading_path": "Frequency Estimation (Space-Saving)", "chunk_index": 0, "text": "## Frequency Estimation (Space-Saving)\n\n- `APPROX_TOP_K`, `APPROX_TOP_K_ACCUMULATE`, `APPROX_TOP_K_COMBINE`\n- `APPROX_TOP_K_ESTIMATE` — not an aggregate; consumes scalar state from ACCUMULATE/COMBINE.", "approx_tokens": 50}
{"chunk_id": "281ab8e2758c77c269babad76dc039450afdcbe8", "doc_id": "commands/AGGREGATE.md", "page_title": "Aggregate Functions", "heading_path": "Percentile Estimation (t-Digest family)", "chunk_index": 0, "text": "## Percentile Estimation (t-Digest family)\n\n- `APPROX_PERCENTILE`, `APPROX_PERCENTILE_ACCUMULATE`, `APPROX_PERCENTILE_COMBINE`\n- `APPROX_PERCENTILE_ESTIMATE` — not an aggregate; consumes scalar digest from ACCUMULATE/COMBINE.", "approx_tokens": 56}
{"chunk_id": "7de97de6d2bd495a4895acd77604d344917f8e20", "doc_id": "commands/AGGREGATE.md", "page_title": "Aggregate Functions", "heading_path": "Aggregation Utilities", "chunk_index": 0, "text": "## Aggregation Utilities\n\n- `GROUPING` — not an aggregate; indicates the aggregation level of a row (with `GROUP BY`/`ROLLUP`/`CUBE`/`GROUPING SETS`).\n- `GROUPING_ID` — alias for `GROUPING`.", "approx_tokens": 47}
{"chunk_id": "812a8f2e3fe9242e85d4c899455c9cf33ce7189c", "doc_id": "commands/AGGREGATE.md", "page_title": "Aggregate Functions", "heading_path": "AI Functions (aggregate variants)", "chunk_index": 0, "text": "## AI Functions (aggregate variants)\n\n- `AI_AGG`\n- `AI_SUMMARIZE_AGG`", "approx_tokens": 17}
{"chunk_id": "d46fe87b91b45a9b3304dea0185a060de0540ccb", "doc_id": "commands/AGGREGATE.md", "page_title": "Aggregate Functions", "heading_path": "Examples (illustrative)", "chunk_index": 0, "text": "## Examples (illustrative)\n\nCount and sum by group:\n\n    SELECT dept, COUNT(*) AS n, SUM(salary) AS payroll\n    FROM employees\n    GROUP BY dept;\n\nDistinct count vs approximate:\n\n    SELECT COUNT(DISTINCT user_id) AS exact_uv,\n           APPROX_COUNT_DISTINCT(user_id) AS approx_uv\n    FROM events;\n\nConcatenate values per group:\n\n    SELECT dept, LISTAGG(employee_name, ', ') WITHIN GROUP (ORDER BY employee_name) AS names\n    FROM employees\n    GROUP BY dept;\n\nMedian and percentiles:\n\n    SELECT MEDIAN(latency_ms) AS p50,\n           PERCENTILE_CONT(0.95) WITHIN GROUP (ORDER BY latency_ms) AS p95\n    FROM request_metrics;\n\nt-Digest workflow (sketch accumulate → estimate):\n\n    -- Build or combine digests by group\n    SELECT region,\n           APPROX_PERCENTILE_ACCUMULATE(latency_ms) AS digest\n    FROM request_metrics\n    GROUP BY region;\n\n    -- Later, estimate from stored digest\n    -- SELECT APPROX_PERCENTILE_ESTIMATE(digest, 0.99) AS p99 FROM stored_digests;", "approx_tokens": 243}
{"chunk_id": "c7b17e3dbffd61a5c37070bb3f9fa864c30f614e", "doc_id": "commands/AGGREGATE.md", "page_title": "Aggregate Functions", "heading_path": "Translator guidance (LLM-facing)", "chunk_index": 0, "text": "## Translator guidance (LLM-facing)\n\n- Preserve aggregate semantics; if the source uses dialect-specific forms, map to Snowflake equivalents (`COUNT_IF`, `LISTAGG`, `PERCENTILE_CONT`, etc.).  \n- Prefer `APPROX_COUNT_DISTINCT` for large distinct counts when performance matters; keep exact `COUNT(DISTINCT ...)` when correctness is required.  \n- Do not invent `WITHIN GROUP` orderings for `LISTAGG`/percentiles; if absent in the source and required for Snowflake, add a `-- TODO:` note.  \n- For sketch-based families (HLL, t-Digest, TOP-K), ensure ACCUMULATE/COMBINE/ESTIMATE functions are used in the correct phases; mark `-- TODO:` when state objects are missing or unclear.", "approx_tokens": 168}
